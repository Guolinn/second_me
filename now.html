<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>/now · Guolin Wang</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,400;600;700&family=Nunito:wght@300;400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="shared-style.css" />
</head>
<body>
  <main class="page">
    <nav class="nav">
      <div class="menu">
        <a href="index.html">/entry</a>
        <a href="now.html">/now</a>
        <a href="mind.html">/mind</a>
        <a href="build.html">/build</a>
        <a href="proof.html">/proof</a>
        <a href="live.html">/live</a>
      </div>
      <a class="login" href="login.html">登录</a>
    </nav>

    <section class="section">
      <h1>/now</h1>
      <p class="quote">“这是一个正在运行中的人。”</p>
    </section>

    <section class="section">
      <h2>Now</h2>
      <div class="flow" id="now-list">
        <div class="flow-item">Loading...</div>
      </div>
    </section>

    <section class="section">
      <h2>Field Notes</h2>
      <div class="flow" id="note-list">
        <div class="flow-item">Loading...</div>
      </div>
    </section>

    <div class="footer-nav">
      <button class="btn outline" onclick="location.href='mind.html'">下一站：/mind</button>
      <button class="btn outline" onclick="location.href='everything.html'">回到 /everything</button>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="supabase-config.js"></script>
  <script src="supabase-client.js"></script>
  <script>
    async function loadNow() {
      const list = document.getElementById('now-list');
      const { data, error } = await supabase
        .from('updates')
        .select('content, created_at')
        .eq('kind', 'now')
        .order('created_at', { ascending: false })
        .limit(4);

      if (error || !data || data.length === 0) {
        list.innerHTML = '<div class="flow-item">No updates yet.</div>';
        return;
      }

      list.innerHTML = data.map(item => `
        <div class="flow-item">${item.content}</div>
      `).join('');
    }

    async function loadNotes() {
      const list = document.getElementById('note-list');
      const { data, error } = await supabase
        .from('updates')
        .select('content, created_at')
        .eq('kind', 'note')
        .order('created_at', { ascending: false })
        .limit(4);

      if (error || !data || data.length === 0) {
        list.innerHTML = '<div class="flow-item">No notes yet.</div>';
        return;
      }

      list.innerHTML = data.map(item => `
        <div class="flow-item">${item.content}</div>
      `).join('');
    }

    loadNow();
    loadNotes();
  </script>

  <a class="secret-link" href="admin-login.html" aria-label="Admin"></a>
</body>
</html>
